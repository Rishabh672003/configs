(()=>{"use strict";var e,t={1152:(e,t,s)=>{s(5334);var i,n=s(1931),o=s(6832),a=(s(8328),s(3145)),r=s.n(a);function c(){c.init||(c.init=!0,i=-1!==function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var s=e.indexOf("rv:");return parseInt(e.substring(s+3,e.indexOf(".",s)),10)}var i=e.indexOf("Edge/");return i>0?parseInt(e.substring(i+5,e.indexOf(".",i)),10):-1}())}function l(e,t,s,i,n,o,a,r,c,l){"boolean"!=typeof a&&(c=r,r=a,a=!1);var h,d="function"==typeof s?s.options:s;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,n&&(d.functional=!0)),i&&(d._scopeId=i),o?(h=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,c(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},d._ssrRegister=h):t&&(h=a?function(e){t.call(this,l(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,r(e))}),h)if(d.functional){var u=d.render;d.render=function(e,t){return h.call(t),u(e,t)}}else{var m=d.beforeCreate;d.beforeCreate=m?[].concat(m,h):[h]}return s}var h={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},mounted:function(){var e=this;c(),this.$nextTick((function(){e._w=e.$el.offsetWidth,e._h=e.$el.offsetHeight,e.emitOnMount&&e.emitSize()}));var t=document.createElement("object");this._resizeObject=t,t.setAttribute("aria-hidden","true"),t.setAttribute("tabindex",-1),t.onload=this.addResizeHandlers,t.type="text/html",i&&this.$el.appendChild(t),t.data="about:blank",i||this.$el.appendChild(t)},beforeDestroy:function(){this.removeResizeHandlers()},methods:{compareAndNotify:function(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize:function(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers:function(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers:function(){this._resizeObject&&this._resizeObject.onload&&(!i&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}},d=function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"resize-observer",attrs:{tabindex:"-1"}})};d._withStripped=!0;var u=l({render:d,staticRenderFns:[]},void 0,h,"data-v-8859cc6c",!1,void 0,!1,void 0,void 0,void 0),m={version:"1.0.1",install:function(e){e.component("resize-observer",u),e.component("ResizeObserver",u)}},g=null;"undefined"!=typeof window?g=window.Vue:void 0!==s.g&&(g=s.g.Vue),g&&g.use(m);var f=s(330),p=s(7877),v=s(1407),w=(s(7166),s(4319),s(4219),s(2003)),b=(s(7689),s(14),s(7537),s(1873)),_=s(5454),C=s(1068),y=s(2667),I=s(5221),E=s(7788),$=s(4020);const A={name:"v-dense-select",model:{prop:"value",event:"change"},props:{options:{required:!0},value:{type:String,required:!1},disabled:{type:Boolean,default:!1}},watch:{value:function(){this.select&&this.setValue()},disabled:function(){this.select&&this.setDisabled()}},methods:{onChange:function(){this.$emit("change",this.select.value)},setDisabled:function(){this.select.disabled=this.disabled},setValue:function(){if(this.value){for(const[e,t]of this.options.entries())if(t.id===this.value){this.select.selectedIndex=e;break}}else this.select.selectedIndex=-1}},mounted:function(){this.select=new $.H(this.$el),this.select.listen("MDCSelect:change",this.onChange),this.setDisabled(),this.setValue()}};var x=s(1900);const S=(0,x.Z)(A,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"mdc-select mdc-select--no-label"},[e._m(0),e._v(" "),s("div",{staticClass:"mdc-select__menu mdc-menu mdc-menu-surface"},[s("ul",{staticClass:"mdc-list"},e._l(e.options,(function(t){return s("li",{key:t.id,staticClass:"mdc-list-item",attrs:{"data-value":t.id,"aria-selected":t.id===e.value}},[e._v("\n        "+e._s(t.label)+"\n      ")])})),0)])])}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"mdc-select__anchor"},[s("i",{staticClass:"mdc-select__dropdown-icon"}),e._v(" "),s("div",{staticClass:"mdc-select__selected-text"}),e._v(" "),s("div",{staticClass:"mdc-line-ripple"})])}],!1,null,null,null).exports,M={components:{[v.Z.name]:v.Z,[w.Z.name]:w.Z,[b.Z.name]:b.Z,[_.Z.name]:_.Z,[S.name]:S,[u.name]:u},data:function(){let e=["select","selectUpload","capture","upload","url"];return(this.$env.isSamsung||this.$env.isSafari&&this.$env.isMobile)&&(e=e.filter((e=>"capture"!==e))),{dataLoaded:!1,processing:!1,searchModeAction:"",imageUrl:"",previewImages:null,showBrowseButtons:!1,settingsEnterActive:!1,listItems:{...(0,o.qZ)({actionMenu:["options","website"]},{scope:"actionMenu"}),...(0,o.qZ)({searchModeAction:e},{scope:"optionValue_action_searchModeAction"})},hasScrollBar:!1,engines:[],searchAllEngines:!1,shareImageEnabled:!1,browseEnabled:!1,pasteEnabled:!1,autoPasteEnabled:!1,enableContributions:I.pL}},computed:{separatorClasses:function(){return{visible:this.searchAllEngines||this.hasScrollBar}},showSettings:function(){return"url"===this.searchModeAction||"upload"===this.searchModeAction&&(this.browseEnabled||this.pasteEnabled)}},methods:{getText:y.Q,getEngineIcon:o.HF,onEngineClick:async function(e){if(this.startProcessing())try{let t;if("url"===this.searchModeAction){if(!(0,o.mQ)(this.imageUrl))return this.focusImageUrlInput(),void(0,o.c0)({messageId:"error_invalidImageUrl"})}else if("upload"===this.searchModeAction&&this.previewImages){const e=this.previewImages.map((e=>e.image));if(t=await this.processFiles(e),!t)return void(0,o.c0)({messageId:"error_invalidImageFile"})}await r().runtime.sendMessage({id:"actionPopupSubmit",engine:e,images:t,imageUrl:this.imageUrl}),this.closeAction()}catch(e){throw this.stopProcessing(),await r().runtime.sendMessage({id:"notification",messageId:"error_internalError"}),e}},processFiles:async function(e){if(e){const t=[];for(const s of e){const{dataUrl:e,type:i,ext:n}=await(0,o.u5)({blob:s});if(e){const a=(0,o.ps)({filename:s.name,ext:n});t.push({imageDataUrl:e,imageFilename:a,imageType:i,imageExt:n,imageSize:s.size})}}if(t.length)return t}},startProcessing:function(){if(!this.processing)return this.processing=!0,!0},stopProcessing:function(){this.processing=!1},onSearchModeChange:function(e,t){C.default.set({searchModeAction:e}),"upload"===e?this.setupBrowseSearchModeSettings():"url"===e&&"upload"===t&&window.setTimeout(this.focusImageUrlInput,300)},setupBrowseSearchModeSettings:function(){this.autoPasteEnabled?(this.showBrowseButtons=!1,this.processClipboardImages()):this.showBrowseButtons=!0},onBrowseButtonClick:function(){this.processing||this.$refs.browseInput.click()},onPasteButtonClick:function(){this.startProcessing()&&this.processClipboardImages({showError:!0}).finally((()=>{this.stopProcessing()}))},onBrowseInputChange:function(e){if(console.log(11111,e),!this.startProcessing())return;const t=e.target.files;this.processSelectedImages(t).finally((()=>{this.stopProcessing()}))},processClipboardImages:async function(){let{showError:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const t=await(0,o.eX)();this.showPreviewImages(t),!t&&e&&await r().runtime.sendMessage({id:"notification",messageId:"error_invalidImageFile"})}catch(e){throw await r().runtime.sendMessage({id:"notification",messageId:"error_internalError"}),e}},processSelectedImages:async function(e){try{if(e.length>3)return void await r().runtime.sendMessage({id:"notification",messageId:"error_invalidImageCount"});const t=(0,o.fC)(Array.from(e));this.showPreviewImages(t),t||await r().runtime.sendMessage({id:"notification",messageId:"error_invalidImageFile"})}catch(e){throw await r().runtime.sendMessage({id:"notification",messageId:"error_internalError"}),e}},showPreviewImages:function(e){e?(this.showBrowseButtons=!1,this.previewImages=e.map((e=>({image:e,objectUrl:URL.createObjectURL(e)})))):this.showBrowseButtons=!0},hidePreviewImages:function(){this.previewImages.forEach((e=>URL.revokeObjectURL(e.objectUrl))),this.previewImages=null,this.showBrowseButtons=!0},shareImage:async function(){await r().runtime.sendMessage({id:"initShare"}),this.closeAction()},showContribute:async function(){await(0,o.jd)(),this.closeAction()},showOptions:async function(){this.$env.isSamsung?await(0,y.ZW)({url:r().runtime.getURL("/src/options/index.html")}):await r().runtime.openOptionsPage(),this.closeAction()},showWebsite:async function(){await(0,o.$)(),this.closeAction()},showActionMenu:function(){this.$refs.actionMenu.$emit("open")},onActionMenuSelect:async function(e){"options"===e?await this.showOptions():"website"===e&&await this.showWebsite()},closeAction:async function(){const e=await r().tabs.getCurrent();e&&e.id!==r().tabs.TAB_ID_NONE&&!this.$env.isSafari?r().tabs.remove(e.id):window.close()},focusImageUrlInput:function(){this.$refs.imageUrlInput.$refs.input.focus()},settingsBeforeEnter:function(){this.settingsEnterActive=!0,this.lockPopupHeight()},settingsBeforeLeave:function(){this.lockPopupHeight()},settingsAfterEnter:function(){this.settingsEnterActive=!1,this.configureScrollBar(),"url"===this.searchModeAction&&this.focusImageUrlInput()},settingsAfterLeave:function(){this.unlockPopupHeight(),this.configureScrollBar(),"url"===this.searchModeAction&&(this.imageUrl="")},onListSizeChange:function(){this.configureScrollBar(),this.$env.isMobile&&this.$env.isSafari&&this.setViewportSize()},onListScroll:function(){this.configureScrollBar()},configureScrollBar:function(){if(this.$env.isAndroid||this.$env.isSafari)this.hasScrollBar=this.$refs.items.scrollTop;else{const e=this.$refs.items;this.hasScrollBar=e.scrollHeight>e.clientHeight}},lockPopupHeight:function(){if((this.$env.isAndroid||this.$env.isFirefox)&&!document.documentElement.style.height){const{height:e}=document.documentElement.getBoundingClientRect();document.documentElement.style.height=`${e}px`}},unlockPopupHeight:function(){(this.$env.isAndroid||this.$env.isFirefox)&&document.documentElement.style.height.endsWith("px")&&(document.documentElement.style.height="")},setViewportSize:async function(){const e=await(0,y.fr)(),t=window.innerWidth;e&&t&&e.width>t?this.$env.isMobile?(e.width<394?document.body.style.minWidth=e.width-40+"px":document.body.style.minWidth="354px",this.$el.style.maxHeight=e.height-40+"px",document.documentElement.style.height="",this.$env.isIpados&&(this.$refs.items.style.maxHeight="392px")):this.$refs.items.style.maxHeight="392px":(document.documentElement.style.height="100%",e&&e.width>=354?document.body.style.minWidth="354px":document.body.style.minWidth="initial",this.$el.style.maxHeight="initial",this.$refs.items.style.maxHeight="initial")}},created:async function(){window.addEventListener("resize",this.setViewportSize),window.addEventListener("orientationchange",(()=>window.setTimeout(this.setViewportSize,1e3))),await this.setViewportSize();const e=await C.default.get(E.Gn),t=await(0,o.S_)(e);this.$env.isFirefox&&this.$env.isAndroid&&(t.length<=1||"main"===e.searchAllEnginesAction)?(0,o.c0)({messageId:"error_optionsNotApplied"}):(this.engines=t,this.searchAllEngines="sub"===e.searchAllEnginesAction&&!this.$env.isSamsung,this.searchModeAction=e.searchModeAction,this.shareImageEnabled=e.shareImageAction&&this.$env.isSamsung,this.browseEnabled=!this.$env.isLinux&&!this.$env.isSamsung&&!this.$env.isFirefox,this.pasteEnabled=!(this.$env.isSamsung||this.$env.isMobile&&this.$env.isFirefox),this.autoPasteEnabled=e.autoPasteAction&&!this.$env.isSafari&&!this.$env.isSamsung&&!(this.$env.isMobile&&this.$env.isFirefox),this.$watch("searchModeAction",this.onSearchModeChange),"upload"===this.searchModeAction&&this.setupBrowseSearchModeSettings(),this.dataLoaded=!0)},mounted:function(){window.setTimeout((()=>{for(const e of document.querySelectorAll(".list-bulk-button, .list-items")){const t=new f.e(e);for(const e of t.listElements)p.F.attachTo(e)}"url"!==this.searchModeAction||this.$env.isMobile||this.focusImageUrlInput(),this.$env.isMobile&&this.$env.isSafari&&this.setViewportSize()}),500)}},B=(0,x.Z)(M,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"show",rawName:"v-show",value:e.dataLoaded,expression:"dataLoaded"}],attrs:{id:"app"}},[s("div",{staticClass:"header"},[s("v-dense-select",{staticClass:"search-mode-menu",attrs:{options:e.listItems.searchModeAction},model:{value:e.searchModeAction,callback:function(t){e.searchModeAction=t},expression:"searchModeAction"}}),e._v(" "),s("div",{staticClass:"header-buttons"},[e.enableContributions?s("v-icon-button",{staticClass:"contribute-button",attrs:{src:"/src/contribute/assets/heart.svg"},on:{click:e.showContribute}}):e._e(),e._v(" "),e.shareImageEnabled?s("v-icon-button",{staticClass:"share-button",attrs:{src:"/src/assets/icons/misc/share.svg"},on:{click:e.shareImage}}):e._e(),e._v(" "),s("v-icon-button",{staticClass:"menu-button",attrs:{src:"/src/assets/icons/misc/more.svg"},on:{click:e.showActionMenu}})],1),e._v(" "),s("v-menu",{ref:"actionMenu",staticClass:"action-menu",attrs:{ripple:!0,items:e.listItems.actionMenu},on:{selected:e.onActionMenuSelect}})],1),e._v(" "),e.dataLoaded?s("transition",{attrs:{name:"settings"},on:{"before-enter":e.settingsBeforeEnter,"before-leave":e.settingsBeforeLeave,"after-enter":e.settingsAfterEnter,"after-leave":e.settingsAfterLeave}},[e.showSettings?s("div",{staticClass:"settings"},["url"===e.searchModeAction?s("div",{staticClass:"url-settings"},[s("v-textfield",{ref:"imageUrlInput",attrs:{placeholder:e.getText("inputPlaceholder_imageUrl"),fullwidth:""},model:{value:e.imageUrl,callback:function(t){e.imageUrl="string"==typeof t?t.trim():t},expression:"imageUrl"}})],1):e._e(),e._v(" "),"upload"===e.searchModeAction?s("div",{staticClass:"browse-settings"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.showBrowseButtons,expression:"showBrowseButtons"}],staticClass:"browse-buttons"},[e.browseEnabled?s("input",{ref:"browseInput",staticClass:"browse-input",attrs:{type:"file",accept:"image/*",multiple:""},on:{change:e.onBrowseInputChange}}):e._e(),e._v(" "),e.browseEnabled?s("v-button",{staticClass:"outline-button",attrs:{outlined:"",label:e.getText("buttonText_browse"),disabled:e.processing},on:{click:e.onBrowseButtonClick}}):e._e(),e._v(" "),e.pasteEnabled?s("v-button",{staticClass:"outline-button",attrs:{outlined:"",label:e.getText("buttonText_paste"),disabled:e.processing},on:{click:e.onPasteButtonClick}}):e._e()],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.previewImages&&!e.settingsEnterActive,expression:"previewImages && !settingsEnterActive"}],staticClass:"browse-preview"},[s("div",{staticClass:"preview-images"},e._l(e.previewImages,(function(t,i){return s("picture",{key:i,staticClass:"tile-container"},[s("source",{attrs:{srcset:t.objectUrl,type:t.image.type}}),e._v(" "),s("img",{staticClass:"tile",attrs:{referrerpolicy:"no-referrer",src:"/src/assets/icons/misc/fallback-image.svg",alt:t.image.name}})])})),0),e._v(" "),s("v-icon-button",{staticClass:"preview-close-button",attrs:{src:"/src/assets/icons/misc/close-preview.svg"},on:{click:e.hidePreviewImages}})],1)]):e._e()]):e._e()]):e._e(),e._v(" "),s("div",{staticClass:"list-padding-top"}),e._v(" "),e.searchAllEngines?s("ul",{staticClass:"mdc-list list list-bulk-button"},[s("li",{staticClass:"mdc-list-item list-item",on:{click:function(t){return e.onEngineClick("allEngines")}}},[s("img",{staticClass:"mdc-list-item__graphic list-item-icon",attrs:{src:e.getEngineIcon("allEngines")}}),e._v("\n      "+e._s(e.getText("menuItemTitle_allEngines"))+"\n    ")])]):e._e(),e._v(" "),s("ul",{staticClass:"mdc-list list list-separator",class:e.separatorClasses},[s("li",{staticClass:"mdc-list-divider",attrs:{role:"separator"}})]),e._v(" "),s("div",{ref:"items",staticClass:"list-items-wrap",on:{scroll:e.onListScroll}},[s("resize-observer",{on:{notify:e.onListSizeChange}}),e._v(" "),s("ul",{staticClass:"mdc-list list list-items"},e._l(e.engines,(function(t){return s("li",{key:t.id,staticClass:"mdc-list-item list-item",on:{click:function(s){return e.onEngineClick(t)}}},[s("img",{staticClass:"mdc-list-item__graphic list-item-icon",attrs:{src:e.getEngineIcon(t)}}),e._v("\n        "+e._s(e.getText("menuItemTitle_"+t))+"\n      ")])})),0)],1)],1)}),[],!1,null,null,null).exports;!async function(){await(0,o.yB)(n.Z);try{await document.fonts.load("400 14px Roboto"),await document.fonts.load("500 14px Roboto")}catch(e){}new n.Z({el:"#app",render:e=>e(B)})}()}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var o=s[e]={exports:{}};return t[e].call(o.exports,o,o.exports,i),o.exports}i.m=t,e=[],i.O=(t,s,n,o)=>{if(!s){var a=1/0;for(h=0;h<e.length;h++){for(var[s,n,o]=e[h],r=!0,c=0;c<s.length;c++)(!1&o||a>=o)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(r=!1,o<a&&(a=o));if(r){e.splice(h--,1);var l=n();void 0!==l&&(t=l)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[s,n,o]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.j=2030,(()=>{var e={2030:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,o,[a,r,c]=s,l=0;if(a.some((t=>0!==e[t]))){for(n in r)i.o(r,n)&&(i.m[n]=r[n]);if(c)var h=c(i)}for(t&&t(s);l<a.length;l++)o=a[l],i.o(e,o)&&e[o]&&e[o][0](),e[a[l]]=0;return i.O(h)},s=globalThis.webpackChunksearch_by_image=globalThis.webpackChunksearch_by_image||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var n=i.O(void 0,[2787],(()=>i(1152)));n=i.O(n)})();