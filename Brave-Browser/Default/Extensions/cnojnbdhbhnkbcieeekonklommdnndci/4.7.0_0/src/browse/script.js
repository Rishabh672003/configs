(()=>{"use strict";var e,t={93:(e,t,s)=>{s(5334);var i=s(1931),a=s(6832),n=(s(8328),s(3145)),r=s.n(n);const o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;var c=s(330),l=s(7877),d=s(1407),h=(s(7166),s(4319),s(4219),s(2003),s(7689),s(14),s(7537),s(1873),s(5454),s(1068)),g=s(2667),u=s(7788);const p={components:{[d.Z.name]:d.Z},data:function(){return{dataLoaded:!1,processing:!1,isShare:!1,showSpinner:!1,showError:"",dropState:!1,showBrowseArea:!0,images:null,session:null,engines:[],searchAllEngines:!1,pasteEnabled:!1,dropEnabled:!1,confirmPaste:!1}},computed:{appClasses:function(){return{"list-separator-hidden":!this.searchAllEngines,"browse-view":!this.isShare,"share-view":this.isShare}}},methods:{getText:g.Q,getEngineIcon:a.HF,setup:async function(){const e=await h.default.get(u.Gn);if(this.isShare){const s=new URL(window.location.href).searchParams.get("id");if("string"==typeof(t=s)&&o.test(t)){const e=await r().runtime.sendNativeMessage("application.id",{id:"getSharedImage",shareId:s});if(e){const t=(0,g.kD)(`data:${(0,a.zd)(e.imageExt)||"text/plain"};base64,${e.imageDataStr}`),s=await this.processFiles([t]);s?this.images=s:this.showError=(0,g.Q)("error_invalidImageFile")}else this.showError=(0,g.Q)("error_invalidPageUrl")}else this.showError=(0,g.Q)("error_invalidPageUrl");const i=await(0,a.S_)(e);this.engines=i,this.searchAllEngines="sub"===e.searchAllEnginesAction&&!this.$env.isSamsung}else{const t=new URL(window.location.href).searchParams.get("id"),s=await r().runtime.sendMessage({id:"storageRequest",asyncResponse:!0,saveReceipt:!0,storageId:t});s?this.session=s:this.showError=(0,g.Q)("error_invalidPageUrl"),this.dropEnabled=!this.$env.isAndroid,this.pasteEnabled=!(this.$env.isSamsung||this.$env.isMobile&&this.$env.isFirefox),this.confirmPaste=e.confirmPaste,this.pasteEnabled&&window.addEventListener("paste",this.onPasteEvent,{capture:!0,passive:!1})}var t;this.dataLoaded=!0},processFiles:async function(e){if(e){const t=[];for(const s of e){const{dataUrl:e,type:i,ext:n}=await(0,a.u5)({blob:s});if(e){const r=(0,a.ps)({filename:s.name,ext:n});t.push({imageDataUrl:e,imageFilename:r,imageType:i,imageExt:n,imageSize:s.size})}}if(t.length)return t}},startProcessing:function(){if(!this.processing)return this.processing=!0,!0},stopProcessing:function(){this.processing=!1},onEngineClick:async function(e){if(this.startProcessing())try{const t=r().tabs.getCurrent();this.session=await(0,a.ed)({sessionOrigin:"share",searchMode:"upload",sourceTabId:t.id,sourceTabIndex:t.index,engine:e}),await this.initSearch()}catch(e){throw this.stopProcessing(),await r().runtime.sendMessage({id:"notification",messageId:"error_internalError"}),e}},onCancelButtonClick:function(){this.processing||this.hidePreviewImages()},onSearchButtonClick:async function(){if(this.startProcessing())try{await this.initSearch()}catch(e){throw this.stopProcessing(),await r().runtime.sendMessage({id:"notification",messageId:"error_internalError"}),e}},onBrowseButtonClick:function(){this.processing||this.$refs.browseInput.click()},onPasteButtonClick:function(){this.startProcessing()&&this.processClipboardImages().finally((()=>{this.stopProcessing()}))},onFileEvent:function(e,t){if(!this.startProcessing())return;let s;"input-event"===t?s=e.target.files:"drop-event"===t&&(s=e.dataTransfer.files),this.processSelectedImages(s).finally((()=>{this.stopProcessing(),"drop-event"===t&&(this.dropState=!1)}))},onPasteEvent:function(e){if(!this.startProcessing())return;if(e.preventDefault(),e.stopImmediatePropagation(),this.showSpinner||this.showError)return void this.stopProcessing();const t=Array.prototype.slice.call(e.clipboardData.files,0,3);this.processClipboardImages(t).finally((()=>{this.stopProcessing()}))},processClipboardImages:async function(e){try{e||(e=await(0,a.QT)());const t=await this.processFiles(e);t?this.confirmPaste?this.showPreviewImages(t):await this.initSearch(t):await r().runtime.sendMessage({id:"notification",messageId:"error_invalidImageFile"})}catch(e){throw await r().runtime.sendMessage({id:"notification",messageId:"error_internalError"}),e}},processSelectedImages:async function(e){try{if(e.length>3)return void await r().runtime.sendMessage({id:"notification",messageId:"error_invalidImageCount"});const t=await this.processFiles(e);t?await this.initSearch(t):await r().runtime.sendMessage({id:"notification",messageId:"error_invalidImageFile"})}catch(e){throw await r().runtime.sendMessage({id:"notification",messageId:"error_internalError"}),e}},showPreviewImages:function(e){this.showBrowseArea=!1,this.images=e},hidePreviewImages:function(){this.images=null,this.showBrowseArea=!0},initSearch:async function(e){this.showSpinner=!0;try{await r().runtime.sendMessage({id:"imageUploadSubmit",images:e||this.images,session:this.session})}catch(e){throw this.showSpinner=!1,e}}},created:function(){document.title=(0,g.Q)("pageTitle",[(0,g.Q)("pageTitle_browse"),(0,g.Q)("extensionName")]),this.isShare="share"===new URL(window.location.href).searchParams.get("origin"),this.setup()},mounted:function(){this.isShare&&window.setTimeout((()=>{for(const e of document.querySelectorAll(".list-bulk-button, .list-items")){const t=new c.e(e);for(const e of t.listElements)l.F.attachTo(e)}}),500)}},m=(0,s(1900).Z)(p,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.dataLoaded?s("div",{class:e.appClasses,attrs:{id:"app"}},[e.isShare||e.showSpinner||e.showError?e._e():s("div",{staticClass:"browse-content"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.showBrowseArea,expression:"showBrowseArea"}],staticClass:"browse-area"},[e.dropEnabled?s("div",{staticClass:"drop-zone",on:{drop:function(t){return t.preventDefault(),e.onFileEvent(t,"drop-event")},dragstart:function(t){t.preventDefault(),e.dropState=!0},dragend:function(t){e.dropState=!1},dragenter:function(t){t.preventDefault(),e.dropState=!0},dragleave:function(t){e.dropState=!1},dragover:function(e){e.preventDefault()}}}):e._e(),e._v(" "),s("div",{staticClass:"drop-zone-content"},[s("img",{staticClass:"drop-zone-icon",attrs:{src:"/src/assets/icons/browse/drop-zone-"+(e.dropState?"drop":"drag")+".svg"}}),e._v(" "),s("div",{staticClass:"drop-zone-text"},[e._v("\n          "+e._s(e.dropEnabled?e.getText("pageContent_browse_"+(e.dropState?"drop":"drag")):e.getText("pageContent_browse"))+"\n        ")]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.dropState,expression:"!dropState"}],staticClass:"browse-buttons"},[s("input",{ref:"browseInput",staticClass:"browse-input",attrs:{type:"file",accept:"image/*",multiple:""},on:{change:function(t){return e.onFileEvent(t,"input-event")}}}),e._v(" "),s("v-button",{staticClass:"outline-button",attrs:{outlined:"",label:e.getText("buttonText_browse"),disabled:e.processing},on:{click:e.onBrowseButtonClick}}),e._v(" "),e.pasteEnabled?s("v-button",{staticClass:"outline-button",attrs:{outlined:"",label:e.getText("buttonText_paste"),disabled:e.processing},on:{click:e.onPasteButtonClick}}):e._e()],1)])]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.images,expression:"images"}],staticClass:"browse-preview"},[s("div",{staticClass:"preview-images"},e._l(e.images,(function(t,i){return s("picture",{key:i,staticClass:"tile-container"},[s("source",{attrs:{srcset:t.imageDataUrl,type:t.imageType}}),e._v(" "),s("img",{staticClass:"tile",attrs:{referrerpolicy:"no-referrer",src:"/src/assets/icons/misc/fallback-image.svg",alt:t.imageFilename}})])})),0),e._v(" "),s("div",{staticClass:"preview-buttons"},[s("v-button",{staticClass:"outline-button",attrs:{outlined:"",label:e.getText("buttonText_cancel"),disabled:e.processing},on:{click:e.hidePreviewImages}}),e._v(" "),s("v-button",{staticClass:"outline-button",attrs:{outlined:"",label:e.getText("buttonText_search"),disabled:e.processing},on:{click:e.onSearchButtonClick}})],1)])]),e._v(" "),!e.isShare||e.showSpinner||e.showError?e._e():s("div",{staticClass:"share-content"},[s("div",{staticClass:"preview-images"},e._l(e.images,(function(t,i){return s("picture",{key:i,staticClass:"tile-container"},[s("source",{attrs:{srcset:t.imageDataUrl,type:t.imageType}}),e._v(" "),s("img",{staticClass:"tile",attrs:{referrerpolicy:"no-referrer",src:"/src/assets/icons/misc/fallback-image.svg",alt:t.imageFilename}})])})),0),e._v(" "),s("div",{staticClass:"list-container"},[e.searchAllEngines?s("ul",{staticClass:"mdc-list list list-bulk-button"},[s("li",{staticClass:"mdc-list-item list-item",on:{click:function(t){return e.onEngineClick("allEngines")}}},[s("img",{staticClass:"mdc-list-item__graphic list-item-icon",attrs:{src:e.getEngineIcon("allEngines")}}),e._v("\n          "+e._s(e.getText("menuItemTitle_allEngines"))+"\n        ")])]):e._e(),e._v(" "),e._m(0),e._v(" "),s("ul",{staticClass:"mdc-list list list-items"},e._l(e.engines,(function(t){return s("li",{key:t.id,staticClass:"mdc-list-item list-item",on:{click:function(s){return e.onEngineClick(t)}}},[s("img",{staticClass:"mdc-list-item__graphic list-item-icon",attrs:{src:e.getEngineIcon(t)}}),e._v("\n          "+e._s(e.getText("menuItemTitle_"+t))+"\n        ")])})),0)])]),e._v(" "),e.showError?s("div",{staticClass:"error-content"},[s("img",{staticClass:"error-icon",attrs:{src:"/src/assets/icons/misc/error.svg"}}),e._v(" "),s("div",{staticClass:"error-text"},[e._v(e._s(e.showError))])]):e._e(),e._v(" "),e.showSpinner&&!e.showError?s("div",{staticClass:"sk-rotating-plane"}):e._e()]):e._e()}),[function(){var e=this.$createElement,t=this._self._c||e;return t("ul",{staticClass:"mdc-list list list-separator"},[t("li",{staticClass:"mdc-list-divider",attrs:{role:"separator"}})])}],!1,null,null,null).exports;!async function(){await(0,a.yB)(i.Z);try{await document.fonts.load("400 14px Roboto"),await document.fonts.load("500 14px Roboto")}catch(e){}new i.Z({el:"#app",render:e=>e(m)})}()}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var n=s[e]={exports:{}};return t[e].call(n.exports,n,n.exports,i),n.exports}i.m=t,e=[],i.O=(t,s,a,n)=>{if(!s){var r=1/0;for(d=0;d<e.length;d++){for(var[s,a,n]=e[d],o=!0,c=0;c<s.length;c++)(!1&n||r>=n)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(o=!1,n<r&&(r=n));if(o){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,a,n]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.j=9088,(()=>{var e={9088:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[r,o,c]=s,l=0;if(r.some((t=>0!==e[t]))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(c)var d=c(i)}for(t&&t(s);l<r.length;l++)n=r[l],i.o(e,n)&&e[n]&&e[n][0](),e[r[l]]=0;return i.O(d)},s=globalThis.webpackChunksearch_by_image=globalThis.webpackChunksearch_by_image||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=i.O(void 0,[2787],(()=>i(93)));a=i.O(a)})();